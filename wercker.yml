box: rails:4.1

build:
  steps:
    - script:
        name: move to rails dir
        code: |
              mkdir rails 
              mv $WERCKER_SOURCE_DIR /rails 
              cd /rails
    - bundle-install:
        cwd: /rails
    - internal/docker-push:
        username: $USERNAME
        password: $PASSWORD
        cmd: rails server
        working-dir: /rails
        ports: 3000
        repository: tonnu/oinker

deploy-to-marathon:
  box: 
    id: buildpack-deps:jessie
  steps:
    - script:
        name: generate json file
        code: chmod +x template.sh && ./template.sh && cat $APP_NAME.json
    - marathon-deploy:
        marathon-url: $MARATHON_URL
        app-name: $APP_NAME
        app-json-file: $APP_JSON
        instances: "3"
